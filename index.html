<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>V√¥lei Pro V1.7</title>
<style>
:root { 
    --accent: #f1c40f; --ultra: #00fbff; --bg: #1a1a1a;
    --common: #bdc3c7; --rare: #3498db; --epic: #9b59b6; --mythic: #e74c3c;
}
body { margin: 0; background: #000; font-family: 'Segoe UI', sans-serif; color: white; overflow: hidden; touch-action: none; height: 100vh; }
.screen { display: none; position: absolute; inset: 0; flex-direction: column; align-items: center; justify-content: center; background: var(--bg); z-index: 100; }
.active { display: flex; }
.catalog-container { width: 95%; max-width: 700px; height: 85%; background: #2c3e50; border-radius: 15px; border: 3px solid var(--accent); overflow: hidden; display: flex; flex-direction: column; }
.tabs { display: flex; background: #34495e; }
.tab-btn { flex: 1; padding: 10px; border: none; background: none; color: white; font-weight: bold; cursor: pointer; border-bottom: 3px solid transparent; font-size: 11px; }
.tab-btn.active-tab { border-bottom: 3px solid var(--accent); background: rgba(255,255,255,0.1); }
.item-grid { flex: 1; display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; padding: 12px; overflow-y: auto; }
.item-card { background: #1e272e; border-radius: 8px; padding: 8px; text-align: center; border: 2px solid transparent; }
.item-card.equipped { border-color: var(--accent); box-shadow: 0 0 8px var(--accent); }
#hud { position: absolute; inset: 0; pointer-events: none; display: none; z-index: 50; }
.hud-top { position: absolute; top: 10px; width: 100%; display: flex; justify-content: center; gap: 40px; font-weight: bold; font-size: 20px; text-shadow: 2px 2px #000; }
.controls { position: absolute; bottom: 15px; width: 100%; display: flex; justify-content: space-between; padding: 0 40px; box-sizing: border-box; pointer-events: auto; }
.btn-act { width: 70px; height: 70px; background: rgba(0,0,0,0.6); border: 2px solid white; border-radius: 50%; color: white; font-weight: bold; display: flex; align-items: center; justify-content: center; }
.energy-bar-wrap { position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%); width: 200px; height: 10px; background: #333; border: 1px solid white; border-radius: 5px; }
#energy-fill { width: 0%; height: 100%; background: var(--ultra); box-shadow: 0 0 10px var(--ultra); }
.btn-main { background: var(--accent); color: black; border: none; padding: 10px; margin: 4px; border-radius: 8px; font-weight: bold; width: 100%; cursor: pointer; }
canvas { width: 100vw; height: 100vh; display: block; }
</style>
</head>
<body>

<!-- LOBBY -->
<div id="screen-lobby" class="screen active">
<div style="text-align: center; background: #2c3e50; padding: 25px; border-radius: 20px; border: 3px solid var(--accent); width: 320px;">
<h1 style="margin:0 0 10px 0; color:var(--accent); font-size: 24px;">V√îLEI 1.7</h1>
<button class="btn-main" onclick="startMode('friendly')">JOGAR NORMAL</button>
<button class="btn-main" style="background: #e67e22" onclick="startMode('tournament')">MODO TORNEIO</button>
<button class="btn-main" style="background:#fff" onclick="openCatalog()">MEU CAT√ÅLOGO</button>
<button class="btn-main" style="background:var(--ultra)" onclick="pullGacha()">ABRIR BA√ö ($150)</button>
<p style="font-size: 14px; margin-top: 10px;">Moedas: <span id="money-display" style="color:var(--accent)">0</span></p>
</div>
</div>

<!-- CAT√ÅLOGO -->
<div id="screen-catalog" class="screen">
<div class="catalog-container">
<div class="tabs">
<button class="tab-btn active-tab" onclick="switchTab('arena')">ARENAS</button>
<button class="tab-btn" onclick="switchTab('ball')">BOLAS</button>
<button class="tab-btn" onclick="switchTab('skill')">ESTILOS</button>
<button class="tab-btn" onclick="switchTab('skin')">SKINS</button>
</div>
<div class="item-grid" id="catalog-grid"></div>
<button class="btn-main" style="border-radius:0; height: 50px;" onclick="setScreen('screen-lobby')">VOLTAR AO MENU</button>
</div>
</div>

<canvas id="gameCanvas"></canvas>

<div id="hud">
<div class="hud-top">
<span style="color: #ff4757">VOC√ä: <span id="p1-score">0</span></span>
<span id="match-info" style="font-size: 14px; color: var(--accent)">AMISTOSO</span>
<span style="color: #2e86de">BOT: <span id="bot-score">0</span></span>
</div>
<div class="energy-bar-wrap"><div id="energy-fill"></div></div>
<div class="controls">
<div style="display: flex; gap: 15px;">
<div class="btn-act" id="m-left">‚Üê</div>
<div class="btn-act" id="m-right">‚Üí</div>
<div class="btn-act" style="background: rgba(255,255,255,0.2); width: 100px; border-radius: 10px;" id="m-dive">DIVE</div>
</div>
<div style="display: flex; gap: 15px;">
<div class="btn-act" style="background:var(--mythic); width: 100px; border-radius: 10px;" id="p-use">ESPECIAL</div>
<div class="btn-act" style="background:var(--accent); color:black;" id="m-jump">PULO</div>
</div>
</div>
</div>

<!-- üî• FIREBASE (SEPARADO) -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDPjk9CQzIfipYaPVPfSr8KGZvxBWRReb0",
  authDomain: "phrasal-waters-484818-b1.firebaseapp.com",
  projectId: "phrasal-waters-484818-b1",
  storageBucket: "phrasal-waters-484818-b1.firebasestorage.app",
  messagingSenderId: "275985211621",
  appId: "1:275985211621:web:107b06cdf8b5afbe68340c",
  measurementId: "G-L6SDP2VT3R"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let playerId = localStorage.getItem("player_id");
if (!playerId) {
  playerId = "player_" + Math.random().toString(36).substr(2, 9);
  localStorage.setItem("player_id", playerId);
}

async function saveCloud(data) {
  await setDoc(doc(db, "players", playerId), data, { merge: true });
}
async function loadCloud() {
  const snap = await getDoc(doc(db, "players", playerId));
  return snap.exists() ? snap.data() : null;
}

window.saveCloud = saveCloud;
window.loadCloud = loadCloud;
</script>

<!-- üéÆ JOGO -->
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 800; canvas.height = 400;

// ================= ITENS =================
const ITEMS = [
{ id:'arena_verde', name:'Deserto Verde', type:'arena', rarity:'common', icon:'üåµ', color:'#2ecc71'},
{ id:'arena_noite', name:'Noite √Årida', type:'arena', rarity:'rare', icon:'üåë', color:'#1a1a2e'},
{ id:'arena_rua', name:'Rua de Tarde', type:'arena', rarity:'common', icon:'üåá', color:'#e67e22'},
{ id:'ball_normal', name:'Bola Comum', type:'ball', rarity:'common', icon:'üèê', color:'white'},
{ id:'ball_crystal', name:'Bola M√≠tica', type:'ball', rarity:'mythic', icon:'üíé', color:'#00fbff'},
{ id:'style_none', name:'Normal', type:'skill', rarity:'common', icon:'‚ö™'},
{ id:'style_asahi', name:'Asahi (Spike)', type:'skill', rarity:'mythic', icon:'üí•'},
{ id:'style_noya', name:'Nishinoya (Dive)', type:'skill', rarity:'epic', icon:'üõ°Ô∏è'},
{ id:'style_setter', name:'Setter', type:'skill', rarity:'epic', icon:'üß†'},
{ id:'skin_default', name:'Normal', type:'skin', rarity:'common', icon:'üë§', color:'red'},
{ id:'skin_ninja', name:'Ninja', type:'skin', rarity:'epic', icon:'ü•∑', color:'#111'},
{ id:'skin_robot', name:'Rob√¥', type:'skin', rarity:'rare', icon:'ü§ñ', color:'#95a5a6'},
{ id:'skin_asahi', name:'Asahi', type:'skin', rarity:'mythic', icon:'üî•', color:'#ff6b00'},
{ id:'skin_noya', name:'Nishinoya', type:'skin', rarity:'epic', icon:'‚ö°', color:'#f1c40f'},
{ id:'skin_setter', name:'Setter', type:'skin', rarity:'epic', icon:'üß†', color:'#2e86de'},
];

// ================= GAME =================
let game = {
money: parseInt(localStorage.getItem('v17_money')) || 500,
inv: JSON.parse(localStorage.getItem('v17_inv')) || ['arena_verde','ball_normal','skin_default','style_none'],
eq: JSON.parse(localStorage.getItem('v17_eq')) || { arena:'arena_verde', ball:'ball_normal', skill:'style_none', skin:'skin_default' },
active:false, mode:'friendly', energy:0, currentTab:'arena',
scoreP1:0, scoreBot:0, lastWinner:'p1'
};

function setScreen(id){
document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
if(id!=='none') document.getElementById(id).classList.add('active');
}

function updateUI(){
document.getElementById('money-display').innerText = game.money;
}
updateUI();

// SAVE LOCAL + FIREBASE
function save() {
  localStorage.setItem('v17_money', game.money);
  localStorage.setItem('v17_inv', JSON.stringify(game.inv));
  localStorage.setItem('v17_eq', JSON.stringify(game.eq));

  if (window.saveCloud) {
    saveCloud({
      money: game.money,
      inv: game.inv,
      eq: game.eq,
      score: game.scoreP1
    });
  }
}

// LOAD FIREBASE
(async () => {
  if(window.loadCloud){
    const data = await loadCloud();
    if(data){
      game.money = data.money ?? game.money;
      game.inv = data.inv ?? game.inv;
      game.eq = data.eq ?? game.eq;
      updateUI();
      console.log("üî• Save do Firebase carregado");
    }
  }
})();
