  <!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>V√¥lei Pro V1.7</title>
<style>
:root { 
    --accent: #f1c40f; --ultra: #00fbff; --bg: #1a1a1a;
}
body { margin: 0; background: #000; font-family: 'Segoe UI', sans-serif; color: white; overflow: hidden; touch-action: none; height: 100vh; }

.screen { display: none; position: absolute; inset: 0; flex-direction: column; align-items: center; justify-content: center; background: var(--bg); z-index: 10; }
.active { display: flex; }

.btn-main { background: var(--accent); color: black; border: none; padding: 10px; margin: 4px; border-radius: 8px; font-weight: bold; width: 100%; cursor: pointer; }

canvas { width: 100vw; height: 100vh; display: block; position: absolute; inset: 0; z-index: 1; }

#hud { position: absolute; inset: 0; pointer-events: none; display: none; z-index: 5; }
.controls { position: absolute; bottom: 15px; width: 100%; display: flex; justify-content: space-between; padding: 0 40px; pointer-events: auto; }
.btn-act { width: 70px; height: 70px; background: rgba(0,0,0,0.6); border: 2px solid white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }
</style>
</head>
<body>

<!-- LOBBY -->
<div id="screen-lobby" class="screen active">
<div style="text-align:center;background:#2c3e50;padding:25px;border-radius:20px;border:3px solid var(--accent);width:320px;">
<h1 style="color:var(--accent)">V√îLEI 1.7</h1>
<button class="btn-main" onclick="startMode('friendly')">JOGAR NORMAL</button>
<button class="btn-main" style="background:#e67e22" onclick="startMode('tournament')">MODO TORNEIO</button>
<button class="btn-main" style="background:#fff" onclick="openCatalog()">MEU CAT√ÅLOGO</button>
<button class="btn-main" style="background:var(--ultra)" onclick="pullGacha()">ABRIR BA√ö ($150)</button>
<p>Moedas: <span id="money-display">0</span></p>
</div>
</div>

<!-- CAT√ÅLOGO -->
<div id="screen-catalog" class="screen">
<div style="background:#2c3e50;width:90%;height:80%;border-radius:15px;padding:10px;">
<div>
<button onclick="switchTab('arena')">ARENAS</button>
<button onclick="switchTab('ball')">BOLAS</button>
<button onclick="switchTab('skill')">ESTILOS</button>
<button onclick="switchTab('skin')">SKINS</button>
</div>
<div id="catalog-grid"></div>
<button class="btn-main" onclick="setScreen('screen-lobby')">VOLTAR</button>
</div>
</div>

<canvas id="gameCanvas"></canvas>

<div id="hud">
<div class="controls">
<div>
<div class="btn-act" id="m-left">‚Üê</div>
<div class="btn-act" id="m-right">‚Üí</div>
</div>
<div>
<div class="btn-act" id="m-jump">PULO</div>
</div>
</div>
</div>

<!-- üî• FIREBASE (MODULE) -->

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDPjk9CQzIfipYaPVPfSr8KGZvxBWRReb0",
  authDomain: "phrasal-waters-484818-b1.firebaseapp.com",
  projectId: "phrasal-waters-484818-b1",
  storageBucket: "phrasal-waters-484818-b1.firebasestorage.app",
  messagingSenderId: "275985211621",
  appId: "1:275985211621:web:107b06cdf8b5afbe68340c",
  measurementId: "G-L6SDP2VT3R"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let playerId = localStorage.getItem("player_id");
if (!playerId) {
  playerId = "player_" + Math.random().toString(36).substr(2, 9);
  localStorage.setItem("player_id", playerId);
}

async function saveCloud(data) {
  await setDoc(doc(db, "players", playerId), data, { merge: true });
}

async function loadCloud() {
  const snap = await getDoc(doc(db, "players", playerId));
  return snap.exists() ? snap.data() : null;
}

window.saveCloud = saveCloud;
window.loadCloud = loadCloud;
</script>
<!-- üéÆ JOGO NORMAL (SEM MODULE) -->
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = 800;
canvas.height = 400;

const ITEMS = [
 {id:'arena_verde', type:'arena', name:'Verde'},
 {id:'ball_normal', type:'ball', name:'Normal'},
 {id:'style_none', type:'skill', name:'Normal'},
 {id:'skin_default', type:'skin', name:'Normal'},
];

let game = {
 money: parseInt(localStorage.getItem("v17_money")) || 500,
 inv: JSON.parse(localStorage.getItem("v17_inv")) || ['arena_verde','ball_normal','skin_default','style_none'],
 eq: JSON.parse(localStorage.getItem("v17_eq")) || {arena:'arena_verde',ball:'ball_normal',skill:'style_none',skin:'skin_default'},
 currentTab:'arena',
 active:false
};

function setScreen(id){
 document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
 if(id!=="none") document.getElementById(id).classList.add("active");
}

function updateUI(){
 document.getElementById("money-display").innerText = game.money;
}
updateUI();

function save(){
 localStorage.setItem("v17_money", game.money);
 localStorage.setItem("v17_inv", JSON.stringify(game.inv));
 localStorage.setItem("v17_eq", JSON.stringify(game.eq));
 if(window.saveCloud){
   saveCloud(game);
 }
}

async function load(){
 if(window.loadCloud){
   const data = await loadCloud();
   if(data){
     game = {...game, ...data};
     updateUI();
   }
 }
}
load();

// ===== LOBBY =====
function startMode(){
 setScreen("none");
 document.getElementById("hud").style.display="block";
 game.active=true;
 loop();
}

// ===== CAT√ÅLOGO =====
function openCatalog(){
 setScreen("screen-catalog");
 renderCatalog();
}

function switchTab(tab){
 game.currentTab = tab;
 renderCatalog();
}

function renderCatalog(){
 const grid = document.getElementById("catalog-grid");
 grid.innerHTML="";
 ITEMS.filter(i=>i.type===game.currentTab).forEach(item=>{
   const btn = document.createElement("button");
   btn.innerText = item.name;
   btn.onclick = ()=>equip(item.type,item.id);
   grid.appendChild(btn);
 });
}

function equip(type,id){
 game.eq[type]=id;
 save();
 renderCatalog();
}

// ===== GACHA COM ANIMA√á√ÉO üî• =====
function pullGacha(){
 if(game.money<150) return alert("Sem moedas!");
 game.money-=150;
 updateUI();

 const overlay = document.createElement("div");
 overlay.style = "position:fixed;inset:0;background:black;display:flex;align-items:center;justify-content:center;font-size:40px;z-index:999;";
 overlay.innerText="üé∞ GIRANDO...";
 document.body.appendChild(overlay);

 setTimeout(()=>{
   const item = ITEMS[Math.floor(Math.random()*ITEMS.length)];
   if(!game.inv.includes(item.id)) game.inv.push(item.id);
   overlay.innerText="‚ú® "+item.name+" ‚ú®";
   save();
   setTimeout(()=>overlay.remove(),1200);
 },1200);
}

// ===== CONTROLES =====
let inputs={left:false,right:false};
document.getElementById("m-left").ontouchstart = ()=>inputs.left=true;
document.getElementById("m-left").ontouchend = ()=>inputs.left=false;
document.getElementById("m-right").ontouchstart = ()=>inputs.right=true;
document.getElementById("m-right").ontouchend = ()=>inputs.right=false;

// ===== LOOP =====
let x=100;
function loop(){
 if(game.active){
   if(inputs.left) x-=3;
   if(inputs.right) x+=3;
 }
 ctx.clearRect(0,0,800,400);
 ctx.fillStyle="red";
 ctx.fillRect(x,300,40,40);
 requestAnimationFrame(loop);
}
</script>
</body>
</html>
