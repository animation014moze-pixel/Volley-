<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>V√¥lei Pro V2.3 - Valentines & Codes</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --accent: #f1c40f; --ultra: #00fbff; --bg: #1a1a1a; --love: #ff6b81; --gold: #ffd700; }
        body { margin: 0; background: #000; font-family: 'Segoe UI', sans-serif; color: white; overflow: hidden; touch-action: none; height: 100vh; }
        .screen { display: none; position: absolute; inset: 0; flex-direction: column; align-items: center; justify-content: center; background: var(--bg); z-index: 100; padding: 20px; box-sizing: border-box; }
        .active { display: flex; }
        .menu-box { background: #2c3e50; padding: 25px; border-radius: 20px; border: 3px solid var(--accent); width: 100%; max-width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .catalog-container { width: 95%; max-width: 700px; height: 85%; background: #2c3e50; border-radius: 15px; border: 3px solid var(--accent); overflow: hidden; display: flex; flex-direction: column; }
        .tabs { display: flex; background: #34495e; }
        .tab-btn { flex: 1; padding: 15px; border: none; background: none; color: white; font-weight: bold; cursor: pointer; border-bottom: 3px solid transparent; font-size: 12px; }
        .tab-btn.active-tab { border-bottom: 3px solid var(--accent); background: rgba(255,255,255,0.1); }
        .item-grid { flex: 1; display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 15px; overflow-y: auto; }
        .item-card { background: #1e272e; border-radius: 10px; padding: 12px; text-align: center; border: 2px solid transparent; position: relative; }
        .item-card.equipped { border-color: var(--accent); background: #2d3436; }
        .event-badge { position: absolute; top: 5px; right: 5px; background: var(--love); font-size: 8px; padding: 2px 5px; border-radius: 5px; color: white; }
        .btn-main { background: var(--accent); color: black; border: none; padding: 14px; margin: 6px 0; border-radius: 8px; font-weight: bold; width: 100%; cursor: pointer; display: block; }
        canvas { width: 100vw; height: 100vh; display: block; }
        #hud { position: absolute; inset: 0; pointer-events: none; display: none; z-index: 50; }
        .hud-top { position: absolute; top: 15px; width: 100%; display: flex; justify-content: center; gap: 40px; font-weight: bold; font-size: 22px; }
        .btn-exit { position: absolute; top: 15px; right: 15px; background: #e74c3c; color: white; border: none; width: 40px; height: 40px; border-radius: 50%; font-weight: bold; cursor: pointer; pointer-events: auto; z-index: 60; }
        .controls { position: absolute; bottom: 15px; width: 100%; display: flex; justify-content: space-between; padding: 0 20px; box-sizing: border-box; pointer-events: auto; }
        .btn-act { width: 60px; height: 60px; background: rgba(0,0,0,0.6); border: 2px solid white; border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; }
    </style>
</head>
<body>

<div id="screen-lobby" class="screen active">
    <div class="menu-box">
        <h1 id="title-main" style="color:var(--accent); margin-bottom:5px;">V√îLEI PRO</h1>
        <p style="margin-top:0; font-size: 1.2em;">üí∞ <span id="money-display">0</span></p>
        <button class="btn-main" onclick="startMode('friendly')">TREINAMENTO</button>
        <button class="btn-main" style="background:#8e44ad; color:white;" onclick="setScreen('screen-multi-choice')">MULTIPLAYER</button>
        <button class="btn-main" style="background:#fff" onclick="openCatalog()">MEU CAT√ÅLOGO</button>
        <button class="btn-main" style="background:var(--ultra)" onclick="pullGacha()">ABRIR BA√ö ($150)</button>
        <button class="btn-main" style="background:#2ecc71; color:white; font-size: 10px;" onclick="promptCode()">INSERIR C√ìDIGO</button>
    </div>
</div>

<div id="screen-multi-choice" class="screen">
    <div class="menu-box">
        <h2 style="color:var(--ultra)">MODOS ONLINE</h2>
        <button class="btn-main" onclick="startMode('multi-local')">MODO LOCAL (P2P)</button>
        <button class="btn-main" style="background:#2ecc71; color:white;" onclick="setScreen('screen-rooms')">SALAS PRIVADAS</button>
        <button class="btn-main" style="background:#95a5a6" onclick="setScreen('screen-lobby')">VOLTAR</button>
    </div>
</div>

<div id="screen-rooms" class="screen">
    <div class="menu-box">
        <h2 style="color:var(--accent)">SALAS ONLINE</h2>
        <button class="btn-main" style="background:#e67e22; color:white" onclick="hostRoom()">CRIAR SALA</button>
        <p id="room-code-display" style="font-family: monospace; font-size: 11px; color: var(--ultra); background: #1a1a1a; padding: 10px; border-radius: 5px; word-break: break-all; min-height: 20px;"></p>
        <input type="text" id="room-input" style="width:80%; padding:10px; border-radius:8px; border:none; text-align:center; margin-bottom:10px" placeholder="COLE O ID">
        <button class="btn-main" onclick="joinRoom()">ENTRAR</button>
        <button class="btn-main" style="background:#95a5a6; margin-top:10px" onclick="setScreen('screen-multi-choice')">VOLTAR</button>
    </div>
</div>

<div id="screen-catalog" class="screen">
    <div class="catalog-container">
        <div class="tabs">
            <button id="tab-arena" class="tab-btn active-tab" onclick="switchTab('arena')">ARENAS</button>
            <button id="tab-ball" class="tab-btn" onclick="switchTab('ball')">BOLAS</button>
            <button id="tab-skin" class="tab-btn" onclick="switchTab('skin')">SKINS</button>
        </div>
        <div id="catalog-grid" class="item-grid"></div>
        <button class="btn-main" style="border-radius:0; height: 60px; background: #e74c3c; color: white;" onclick="setScreen('screen-lobby')">SAIR</button>
    </div>
</div>

<div id="screen-game" class="screen" style="padding:0">
    <button class="btn-exit" onclick="quitGame()">X</button>
    <canvas id="gameCanvas"></canvas>
    <div id="hud">
        <div class="hud-top">
            <span style="color: #ff4757">P1: <span id="p1-score">0</span></span>
            <span style="color: #2e86de">P2: <span id="p2-score">0</span></span>
        </div>
        <div class="controls">
            <div style="display: flex; gap: 10px;">
                <div class="btn-act" id="m-left">‚Üê</div>
                <div class="btn-act" id="m-right">‚Üí</div>
                <div class="btn-act" style="background: rgba(255,255,255,0.2); width: 80px; border-radius: 10px;" id="m-dive">DIVE</div>
            </div>
            <div class="btn-act" style="background:var(--accent); color:black;" id="m-jump">PULO</div>
        </div>
    </div>
</div>

<div id="win-screen" style="position: absolute; inset: 0; background: rgba(0,0,0,0.85); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 200;">
    <div class="win-text" id="winner-label" style="font-size: 40px; color: var(--accent); text-shadow: 0 0 20px var(--accent); margin-bottom: 5px;">P1 VENCEU!</div>
    <div id="money-gain-text" style="color:var(--gold); font-weight:bold;">+$50 MOEDAS</div>
    <div style="width: 220px; margin-top: 20px;">
        <button class="btn-main" id="btn-revanche" onclick="requestRematch()">REVANCHE (0/2)</button>
        <button class="btn-main" style="background:#95a5a6" onclick="quitGame()">SAIR</button>
    </div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 800; canvas.height = 400;

// L√≥gica de Evento
const now = new Date();
const isValentines = (now.getMonth() === 1 && now.getDate() >= 12 && now.getDate() <= 28);

// Itens do Jogo
const ITEMS = [
    {id:'arena_verde', name:'Gramado', type:'arena', icon:'üåµ', color: '#2ecc71', gacha: false},
    {id:'arena_noite', name:'Noite', type:'arena', icon:'üåë', color: '#1a1a2e', gacha: true},
    {id:'arena_tarde', name:'Tarde', type:'arena', icon:'üåÖ', color: '#e67e22', gacha: true}, // GACHA
    {id:'ball_normal', name:'Comum', type:'ball', icon:'üèê', color: 'white', gacha: false},
    {id:'ball_crystal', name:'Cristal', type:'ball', icon:'üíé', color: '#00fbff', gacha: true},
    {id:'skin_default', name:'Padr√£o', type:'skin', icon:'üë§', color:'red', gacha: false},
    {id:'skin_ninja', name:'Ninja', type:'skin', icon:'ü•∑', color:'#2c3e50', gacha: true},
    {id:'skin_robot', name:'Rob√¥', type:'skin', icon:'ü§ñ', color:'#95a5a6', gacha: true} // GACHA
];

if(isValentines) {
    ITEMS.push(
        {id:'skin_love', name:'Cupido', type:'skin', icon:'üíò', color:'#ff748c', event: true, gacha: true},
        {id:'ball_love', name:'Paix√£o', type:'ball', icon:'üíù', color:'white', event: true, gacha: true}
    );
    document.getElementById('title-main').innerText = "V√îLEI PRO ‚ù§Ô∏è";
}

let game = {
    money: parseInt(localStorage.getItem('v19_money')) || 500,
    inv: JSON.parse(localStorage.getItem('v19_inv')) || ['arena_verde', 'ball_normal', 'skin_default'],
    eq: JSON.parse(localStorage.getItem('v19_eq')) || { arena:'arena_verde', ball:'ball_normal', skin:'skin_default' },
    usedCodes: JSON.parse(localStorage.getItem('v19_codes')) || [],
    active: false, mode: 'friendly', scoreP1: 0, scoreP2: 0
};

// --- SISTEMA DE C√ìDIGOS ---
function promptCode() {
    const code = prompt("Digite o c√≥digo da atualiza√ß√£o:").toUpperCase();
    if(!code) return;

    if(game.usedCodes.includes(code)) return alert("C√≥digo j√° utilizado!");

    // C√≥digos v√°lidos apenas DURANTE o evento de Valentines (Fevereiro)
    if(isValentines) {
        if(code === "LOVE2026") {
            addMoney(1000);
            saveCode(code);
            return alert("‚ù§Ô∏è AMOR RECEBIDO! Voc√™ ganhou $1000 moedas!");
        }
        if(code === "CUPIDO") {
            unlockItem('skin_love');
            saveCode(code);
            return alert("üèπ Skin Cupido Desbloqueada!");
        }
    } else {
        // C√≥digos que expiraram
        if(code === "LOVE2026" || code === "CUPIDO") {
            return alert("Este c√≥digo expirou na atualiza√ß√£o de Dia dos Namorados!");
        }
    }

    alert("C√≥digo inv√°lido ou expirado!");
}

function saveCode(code) {
    game.usedCodes.push(code);
    localStorage.setItem('v19_codes', JSON.stringify(game.usedCodes));
}

function unlockItem(id) {
    if(!game.inv.includes(id)) {
        game.inv.push(id);
        localStorage.setItem('v19_inv', JSON.stringify(game.inv));
    }
}

function addMoney(val) {
    game.money += val;
    localStorage.setItem('v19_money', game.money);
    document.getElementById('money-display').innerText = game.money;
}

// --- GACHA ATUALIZADO ---
function pullGacha() {
    if(game.money < 150) return alert("Sem moedas!");
    
    // Filtra itens que podem sair no gacha e que o jogador ainda n√£o tem
    let pool = ITEMS.filter(i => i.gacha && !game.inv.includes(i.id));
    
    // Se n√£o for Valentine's, remove os itens de evento da roleta
    if(!isValentines) {
        pool = pool.filter(i => !i.event);
    }

    if(pool.length === 0) return alert("Voc√™ j√° tem todos os itens dispon√≠veis no momento!");

    game.money -= 150;
    let reward = pool[Math.floor(Math.random() * pool.length)];
    game.inv.push(reward.id);
    
    localStorage.setItem('v19_money', game.money);
    localStorage.setItem('v19_inv', JSON.stringify(game.inv));
    document.getElementById('money-display').innerText = game.money;
    alert(`‚ú® BA√ö ABERTO!\nVoc√™ ganhou: ${reward.name} ${reward.icon}`);
}

// --- RESTANTE DA LOGICA DE JOGO (F√≠sica, Render, Rede) ---
let ball = {x:400, y:120, vx:0, vy:0};
let p1 = {x:100, y:360, vy:0, dash:0}, p2 = {x:650, y:360, vy:0, dash:0};
let inputs = {left: false, right: false, jump: false, dive: false};
let peer = null, conn = null, isHost = false, netInterval = null, clientInputs = {left: false, right: false, jump: false, dive: false}, clientSkin = 'skin_default', rematchVotes = {p1: false, p2: false};

function drawPlayer(p, skinId) {
    ctx.fillStyle = ITEMS.find(i=>i.id===skinId)?.color || 'red';
    ctx.fillRect(p.x, p.y-65, 45, 65);
    if(skinId === 'skin_love') {
        ctx.strokeStyle = "white"; ctx.lineWidth = 3;
        ctx.beginPath(); ctx.moveTo(p.x - 5, p.y - 40); ctx.lineTo(p.x + 50, p.y - 25); ctx.stroke();
        ctx.fillStyle = "red"; ctx.font = "15px Arial"; ctx.fillText("‚ù§Ô∏è", p.x + 40, p.y - 20);
    }
    if(skinId === 'skin_robot') {
        ctx.fillStyle = "cyan"; ctx.fillRect(p.x+10, p.y-55, 25, 10); // "Visor" do rob√¥
    }
}

function drawBall() {
    let ballData = ITEMS.find(i=>i.id===game.eq.ball);
    ctx.fillStyle = ballData.color;
    ctx.beginPath(); ctx.arc(ball.x, ball.y, 12, 0, Math.PI*2); ctx.fill();
    if(game.eq.ball === 'ball_love') {
        ctx.strokeStyle = "#ff4757"; ctx.lineWidth = 4;
        ctx.beginPath(); ctx.moveTo(ball.x - 12, ball.y); ctx.lineTo(ball.x + 12, ball.y); ctx.stroke();
    }
}

function awardMoney(winner) {
    if(winner === 'p1') {
        let amount = game.eq.skin === 'skin_love' ? 75 : 50;
        addMoney(amount);
        document.getElementById('money-gain-text').innerText = `+ $${amount} MOEDAS`;
        document.getElementById('money-gain-text').style.display = 'block';
    } else { document.getElementById('money-gain-text').style.display = 'none'; }
}

function spawnBall() { ball = {x: game.scoreP1 > game.scoreP2 ? p2.x+22 : p1.x+22, y:120, vx:0, vy:0}; }
function setScreen(id) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); document.getElementById('money-display').innerText = game.money; }
function openCatalog() { setScreen('screen-catalog'); renderCatalog(); }
function switchTab(t) { game.currentTab = t; document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active-tab')); document.getElementById('tab-'+t).classList.add('active-tab'); renderCatalog(); }
function renderCatalog() {
    const grid = document.getElementById('catalog-grid'); grid.innerHTML = '';
    ITEMS.filter(i => i.type === game.currentTab).forEach(item => {
        const owned = game.inv.includes(item.id); const eq = game.eq[item.type] === item.id;
        grid.innerHTML += `<div class="item-card ${eq?'equipped':''}">
            ${item.event ? '<span class="event-badge">RARO</span>' : ''}
            <div style="font-size:30px">${item.icon}</div>
            <div style="font-size:10px; margin:5px 0">${item.name}</div>
            <button class="btn-main" style="font-size:10px" ${!owned?'disabled':''} onclick="equip('${item.type}','${item.id}')">
            ${eq?'EQUIPADO':(owned?'USAR':'BLOQUEADO')}</button></div>`;
    });
}
function equip(t, id) { game.eq[t] = id; renderCatalog(); localStorage.setItem('v19_eq', JSON.stringify(game.eq)); }
function startMode(m) { game.mode = m; game.scoreP1 = 0; game.scoreP2 = 0; setScreen('screen-game'); document.getElementById('hud').style.display = 'block'; game.active = true; spawnBall(); }
function quitGame() { game.active = false; setScreen('screen-lobby'); document.getElementById('win-screen').style.display='none'; }

function updatePhys(p, inp, side) {
    let s = p.dash > 0 ? 11 : 5; if(p.dash > 0) p.dash--;
    if(inp.left) p.x -= s; if(inp.right) p.x += s;
    if(inp.jump && p.y >= 360) { p.vy = -10; inp.jump = false; }
    if(inp.dive && p.dash <= 0) { p.dash = 20; inp.dive = false; }
    p.vy += 0.35; p.y += p.vy; if(p.y >= 360) { p.y = 360; p.vy = 0; }
    p.x = (side==='l') ? Math.max(0, Math.min(355, p.x)) : Math.max(405, Math.min(755, p.x));
}

function loop() {
    if(game.active) {
        updatePhys(p1, inputs, 'l');
        if(game.mode==='friendly') {
            let bi = {left: ball.x>360 && p2.x>ball.x, right: ball.x>360 && p2.x<ball.x, jump: ball.y<250 && Math.abs(ball.x-p2.x)<50};
            updatePhys(p2, bi, 'r');
        }
        ball.vy += 0.22; ball.x += ball.vx; ball.y += ball.vy;
        if(ball.x<10 || ball.x>790) ball.vx *= -1;
        [p1, p2].forEach(p => { if(ball.x > p.x && ball.x < p.x+45 && ball.y+10 > p.y-65 && ball.y-10 < p.y) { ball.vy = -9; ball.vx = (ball.x - (p.x+22)) * 0.45; } });
        if(ball.x>395 && ball.x<405 && ball.y>280) { ball.vx *= -1.2; ball.x = ball.x<400?385:415; }
        if(ball.y > 395) { 
            if(ball.x < 400) game.scoreP2++; else game.scoreP1++;
            if(game.scoreP1>=10 || game.scoreP2>=10) { game.active = false; document.getElementById('win-screen').style.display='flex'; awardMoney(game.scoreP1>=10?'p1':'p2'); } 
            else spawnBall();
        }
        let ar = ITEMS.find(i=>i.id===game.eq.arena);
        ctx.fillStyle = ar.color; ctx.fillRect(0,0,800,400);
        ctx.fillStyle = '#d4a373'; ctx.fillRect(0,360,800,40);
        ctx.fillStyle = 'white'; ctx.fillRect(398,280,4,80);
        drawPlayer(p1, game.eq.skin); drawPlayer(p2, 'skin_ninja'); drawBall();
        document.getElementById('p1-score').innerText = game.scoreP1;
        document.getElementById('p2-score').innerText = game.scoreP2;
    }
    requestAnimationFrame(loop);
}

const bH = (id, s) => { const e = document.getElementById(id); e.onpointerdown=(ev)=>{ev.preventDefault(); inputs[s]=true;}; e.onpointerup=(ev)=>{ev.preventDefault(); inputs[s]=false;}; };
bH('m-left', 'left'); bH('m-right', 'right');
document.getElementById('m-jump').onpointerdown=(ev)=>{ev.preventDefault(); inputs.jump=true;};
document.getElementById('m-dive').onpointerdown=(ev)=>{ev.preventDefault(); inputs.dive=true;};

setScreen('screen-lobby'); loop();
</script>
</body>
</html>




    
            
